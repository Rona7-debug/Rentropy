<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="listing.css">
        <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&family=Inria+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Lexend+Deca:wght@100..900&family=Lora:ital,wght@0,400..700;1,400..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <title> Browse Listings </title>
</head>
<body class="no-nav-bg">
    <header class="header">
        <a href="index.html" class="logo">
            <img src="../assets/logo.png" alt="RENTROPY" class="logo-img">
        </a>

        <nav class="nav">
            <a href="index.html" class="nav-link">Home</a>
            <a href="listing.html" class="nav-link nav-link--active">Listings</a>
            <a href="about.html" class="nav-link">About Us</a>
        </nav>

        <div class="header-actions">
            <a href="login.html" class="btn btn-signup">Sign Up</a>
            <a href="login.html" class="btn btn-login">Login</a>
            <a href="cart.html" class="header-cart" aria-label="Cart">ðŸ›’</a>
        </div>

    </header>

    <div class="search-bubble-overlay" id="search-bubble" aria-hidden="true">
        <form class="search-bubble-form" action="listing.html" method="get">

            <div class="search-bubble">
                <input type="search" name="q" class="search-bubble-input" placeholder="Search listings..." aria-label="Search">

                <button type="submit" class="search-bubble-btn" aria-label="Search">

                    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>

                </button>

            </div>

        </form>
    </div>

    <main class="page-main">
        <div class="container page-layout">

            <h1 class="listing-page-title"> All product listings </h1>

            <aside class="filters-sidebar">

                <div class="where-when-cards">
                    <div class="filter-card where-card">
                        <h2 class="filter-card-title">Where</h2>
                        <label class="filter-label" for="where-location">Location</label>
                        <input type="text" id="where-location" name="location" class="filter-input" placeholder="City or area" aria-label="Where do you need it?">
                    </div>
                    <div class="filter-card when-card">
                        <h2 class="filter-card-title">When</h2>
                        <div class="date-range-fields">
                            <div class="filter-group">
                                <label class="filter-label" for="start-date">Start date</label>
                                <input type="date" id="start-date" name="start_date" class="filter-input" aria-label="Rental start date">
                            </div>
                            <div class="filter-group">
                                <label class="filter-label" for="end-date">End date</label>
                                <input type="date" id="end-date" name="end_date" class="filter-input" aria-label="Rental end date">
                            </div>
                        </div>
                    </div>
                </div>

                <h2 class="filters-title">Filters</h2>

                <form class="filters-form">
                    <div class="filter-group">

                        <label class="filter-label">Category</label>
                        
                        <select name="category" class="filter-select">

                            <option value=""> All categories </option>

                            <option value="outdoor"> Outdoor Gear </option>

                            <option value="fashion"> Fashion </option>

                            <option value="tools"> Tools </option>

                            <option value="electronics"> Electronics </option>

                        </select>

                    </div>

                    <div class="filter-group">

                        <label class="filter-label">Price range</label>

                        <div class="price-range">
                            <input type="number" name="price_from" class="filter-input" placeholder="From â‚±" min="0">
                            <input type="number" name="price_to" class="filter-input" placeholder="To â‚±" min="0">
                        </div>

                    </div>

                    <button type="submit" class="btn btn-primary btn-block">Apply filters</button>

                    <a href="listing.html" class="btn btn-signup btn-block">Clear</a>

                </form>

            </aside>

            <div class="listing-content">

                <form class="listing-toolbar" action="listing.html" method="get">

                    <div class="search-bar listing-search">
                        <input type="search" name="q" class="search-input" placeholder="Search listings..." value="" aria-label="Search" list="items">
                        <datalist id="items">
                            <option value="4-Person Camping Tent">
                            <option value="DSLR Camera Kit">
                            <option value="Cordless Power Drill">
                            <option value="Designer Handbag">
                            <option value="Road Bike">
                            <option value="HD Projector">
                            <option value="2-Person Kayak">
                            <option value="Winter Sleeping Bag">
                            <option value="Men's Wool Blazer">
                            <option value="Electric Lawn Mower">
                            <option value="Camera Gimbal Stabilizer">
                            <option value="60L Hiking Backpack">
                            <option value="Evening Gown">
                            <option value="Pressure Washer">
                            <option value="27&quot; 4K Monitor">
                            <option value="Portable Camping Stove">
                            <option value="Formal Suit">
                            <option value="Circular Saw">
                        </datalist>

                        <button type="submit" class="search-btn" aria-label="Search">
                            
                            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>

                        </button>

                    </div>
                    
                </form>

                <div class="listings-grid listings-grid--page" data-view="grid">
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container footer-inner">
            <nav class="footer-nav">

                <a href="index.html" class="footer-link">Home</a>
                <a href="listing.html" class="footer-link">Listings</a>
                <a href="about.html" class="footer-link">About Us</a>
            </nav>

            <p class="footer-copyright">&copy; 2025 RENTROPY. All rights reserved.</p>
        </div>
    </footer>
    
    <script>
        // Items data (pricePerDay in pesos)
        const items = [
            { id: '1', name: '4-Person Camping Tent', category: 'outdoor', pricePerDay: 200, image: '../assets/camping tent.jpg', brand: 'Green Outdoors Co.' },
            { id: '2', name: 'DSLR Camera Kit', category: 'electronics', pricePerDay: 1200, image: '../assets/camera.webp', brand: 'Camera Brand' },
            { id: '3', name: 'Cordless Power Drill', category: 'tools', pricePerDay: 800, image: '../assets/istockphoto-184639599-612x612.jpg', brand: 'Tool Co.' },
            { id: '4', name: 'Designer Handbag', category: 'fashion', pricePerDay: 2500, image: '../assets/designer bag.jpg', brand: 'Fashion Brand' },
            { id: '5', name: 'Road Bike', category: 'outdoor', pricePerDay: 1800, image: '../assets/road bike.jpg', brand: 'Bike Co.' },
            { id: '6', name: 'HD Projector', category: 'electronics', pricePerDay: 1500, image: '../assets/projector.jpg', brand: 'Projector Brand' },
            { id: '7', name: '2-Person Kayak', category: 'outdoor', pricePerDay: 3500, image: '../assets/kayak.jpg', brand: 'Kayak Co.' },
            { id: '8', name: 'Winter Sleeping Bag', category: 'outdoor', pricePerDay: 1200, image: '../assets/sleeping bag.webp', brand: 'Outdoor Gear' },
            { id: '9', name: 'Men\'s Wool Blazer', category: 'fashion', pricePerDay: 2800, image: '../assets/blazer.jpg', brand: 'Fashion Co.' },
            { id: '10', name: 'Electric Lawn Mower', category: 'tools', pricePerDay: 800, image: '../assets/lawn mower.jpg', brand: 'Tool Brand' },
            { id: '11', name: 'Camera Gimbal Stabilizer', category: 'electronics', pricePerDay: 1500, image: '../assets/gimbal.jpg', brand: 'Gimbal Co.' },
            { id: '12', name: '60L Hiking Backpack', category: 'outdoor', pricePerDay: 1200, image: '../assets/backpack.jpg', brand: 'Backpack Brand' },
            { id: '13', name: 'Evening Gown', category: 'fashion', pricePerDay: 2800, image: '../assets/evening gown.jpg', brand: 'Fashion Brand' },
            { id: '14', name: 'Pressure Washer', category: 'tools', pricePerDay: 8500, image: '../assets/pressure washer.webp', brand: 'Tool Co.' },
            { id: '15', name: '27" 4K Monitor', category: 'electronics', pricePerDay: 15000, image: '../assets/monitor.webp', brand: 'Monitor Brand' },
            { id: '16', name: 'Portable Camping Stove', category: 'outdoor', pricePerDay: 1200, image: '../assets/camping stove.jpg', brand: 'Camping Gear' },
            { id: '17', name: 'Formal Suit', category: 'fashion', pricePerDay: 2800, image: '../assets/suit.png', brand: 'Suit Brand' },
            { id: '18', name: 'Circular Saw', category: 'tools', pricePerDay: 8500, image: '../assets/circular saw.webp', brand: 'Tool Co.' }
        ];

        function formatPrice(amount) {
            return 'â‚±' + Number(amount).toLocaleString('en-PH');
        }

        function getPriceText(item, rentalDays) {
            const days = Math.max(1, rentalDays);
            const perDay = formatPrice(item.pricePerDay) + ' per day';
            if (days === 1) return perDay;
            const total = item.pricePerDay * days;
            return perDay + ' Â· ' + formatPrice(total) + ' for ' + days + ' days';
        }

        function getRentalDaysFromDateRange() {
            const startInput = document.getElementById('start-date');
            const endInput = document.getElementById('end-date');
            if (!startInput || !endInput) return 1;
            const startVal = startInput.value;
            const endVal = endInput.value;
            if (!startVal || !endVal) return 1;
            const start = new Date(startVal);
            const end = new Date(endVal);
            if (end < start) return 1;
            const diffTime = end - start;
            const days = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
            return Math.max(1, days);
        }

        function syncDateRangeConstraints() {
            const startInput = document.getElementById('start-date');
            const endInput = document.getElementById('end-date');
            if (!startInput || !endInput) return;
            const today = new Date().toISOString().slice(0, 10);
            startInput.min = today;
            if (startInput.value) {
                endInput.min = startInput.value;
                if (endInput.value && endInput.value < startInput.value) endInput.value = startInput.value;
            } else {
                endInput.min = today;
            }
            if (endInput.value && startInput.value && endInput.value < startInput.value) {
                startInput.value = endInput.value;
            }
        }

        function renderListings(filteredItems, rentalDays) {
            const grid = document.querySelector('.listings-grid');
            grid.innerHTML = '';
            const days = Math.max(1, parseInt(rentalDays, 10) || 1);
            if (filteredItems.length === 0) {
                grid.innerHTML = '<p>No listings found.</p>';
                return;
            }
            const startInput = document.getElementById('start-date');
            const endInput = document.getElementById('end-date');
            const startDate = startInput ? startInput.value : '';
            const endDate = endInput ? endInput.value : '';

            filteredItems.forEach(item => {
                const priceText = getPriceText(item, days);
                const card = document.createElement('a');
                let href = `product.html?id=${item.id}`;
                if (startDate) href += `&start_date=${encodeURIComponent(startDate)}`;
                if (endDate) href += `&end_date=${encodeURIComponent(endDate)}`;
                card.href = href;
                card.className = 'listing-card';
                card.innerHTML = `
                    <div class="listing-card-image">
                        <img src="${item.image}" alt="${item.name}" width="400" height="260">
                    </div>
                    <div class="listing-card-body">
                        <h3 class="listing-card-title">${item.name}</h3>
                        <p class="listing-card-meta">${item.category.charAt(0).toUpperCase() + item.category.slice(1)}</p>
                        <p class="listing-card-price">${priceText}</p>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function filterItems() {
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category') || '';
            const priceFrom = parseInt(urlParams.get('price_from')) || 0;
            const priceTo = parseInt(urlParams.get('price_to')) || Infinity;
            const location = urlParams.get('location') || '';
            const q = urlParams.get('q') || '';
            const rentalDays = getRentalDaysFromDateRange();

            let filtered = items;

            if (category) {
                filtered = filtered.filter(item => item.category === category);
            }

            filtered = filtered.filter(item => {
                const itemPrice = item.pricePerDay;
                return itemPrice >= priceFrom && (priceTo === 0 || priceTo === Infinity || itemPrice <= priceTo);
            });

            if (q) {
                filtered = filtered.filter(item => item.name.toLowerCase().includes(q.toLowerCase()) || item.brand.toLowerCase().includes(q.toLowerCase()));
            }

            renderListings(filtered, rentalDays);
        }

        // On load, filter and render
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            document.querySelector('select[name="category"]').value = urlParams.get('category') || '';
            document.querySelector('input[name="price_from"]').value = urlParams.get('price_from') || '';
            document.querySelector('input[name="price_to"]').value = urlParams.get('price_to') || '';
            const whereInput = document.getElementById('where-location');
            if (whereInput) whereInput.value = urlParams.get('location') || '';
            document.querySelector('input[name="q"]').value = urlParams.get('q') || '';
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            if (startDateInput) startDateInput.value = urlParams.get('start_date') || '';
            if (endDateInput) endDateInput.value = urlParams.get('end_date') || '';
            syncDateRangeConstraints();

            filterItems();

            document.querySelector('select[name="category"]').addEventListener('change', updateFilters);
            document.querySelector('input[name="price_from"]').addEventListener('input', updateFilters);
            document.querySelector('input[name="price_to"]').addEventListener('input', updateFilters);
            if (whereInput) whereInput.addEventListener('input', updateFilters);
            document.querySelector('input[name="q"]').addEventListener('input', updateFilters);
            if (startDateInput) {
                startDateInput.addEventListener('change', function() { syncDateRangeConstraints(); updateFilters(); });
                startDateInput.addEventListener('input', function() { syncDateRangeConstraints(); updateFilters(); });
            }
            if (endDateInput) {
                endDateInput.addEventListener('change', function() { syncDateRangeConstraints(); updateFilters(); });
                endDateInput.addEventListener('input', function() { syncDateRangeConstraints(); updateFilters(); });
            }
        });

        function updateFilters() {
            const category = document.querySelector('select[name="category"]').value;
            const priceFrom = document.querySelector('input[name="price_from"]').value;
            const priceTo = document.querySelector('input[name="price_to"]').value;
            const locationInput = document.getElementById('where-location');
            const location = locationInput ? locationInput.value : '';
            const q = document.querySelector('input[name="q"]').value;
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            const startDate = startDateInput ? startDateInput.value : '';
            const endDate = endDateInput ? endDateInput.value : '';

            const params = new URLSearchParams();
            if (category) params.set('category', category);
            if (priceFrom) params.set('price_from', priceFrom);
            if (priceTo) params.set('price_to', priceTo);
            if (location) params.set('location', location);
            if (q) params.set('q', q);
            if (startDate) params.set('start_date', startDate);
            if (endDate) params.set('end_date', endDate);

            const newUrl = params.toString() ? `listing.html?${params.toString()}` : 'listing.html';
            window.history.pushState({}, '', newUrl);

            filterItems();
        }

        (function () {
            var header = document.querySelector('.header');
            var searchBubble = document.getElementById('search-bubble');
            var fadeDistance = 400;
            var bubbleShowScroll = 180;

            function updateNavOpacity() {
                var opacity = 1 - window.scrollY / fadeDistance;
                header.style.opacity = Math.max(0, Math.min(1, opacity));
            }

            function updateSearchBubble() {
                if (window.scrollY > bubbleShowScroll) {
                    searchBubble.classList.add('search-bubble-overlay--visible');
                    searchBubble.setAttribute('aria-hidden', 'false');
                } else {
                    searchBubble.classList.remove('search-bubble-overlay--visible');
                    searchBubble.setAttribute('aria-hidden', 'true');
                }
            }

            window.addEventListener('scroll', function () {
                updateNavOpacity();
                updateSearchBubble();
            }, { passive: true });
            updateNavOpacity();
            updateSearchBubble();
        })();

        // Check login status and hide/show buttons
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = localStorage.getItem('currentUser');
            const signUpBtn = document.querySelector('.btn-signup');
            const loginBtn = document.querySelector('.btn-login');
            const headerActions = document.querySelector('.header-actions');
            if (currentUser) {
                // User is logged in, hide login and signup buttons, add profile icon
                if (signUpBtn) signUpBtn.style.display = 'none';
                if (loginBtn) loginBtn.style.display = 'none';
                // Add profile icon beside cart
                const cartLink = document.querySelector('.header-cart');
                if (cartLink) {
                    const profileLink = document.createElement('a');
                    profileLink.href = 'dashboard.html';
                    profileLink.className = 'header-profile';
                    profileLink.setAttribute('aria-label', 'Profile');
                    profileLink.textContent = 'ðŸ‘¤';
                    cartLink.insertAdjacentElement('afterend', profileLink);
                }
            }
        });
    </script>
</body>
</html>