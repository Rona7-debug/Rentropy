<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&family=Inria+Sans:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Lexend+Deca:wght@100..900&family=Lora:ital,wght@0,400..700;1,400..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="product.css">
    <title>RENTROPY</title>
</head>
<body>
    <header class="header">
        <a href="index.html" class="logo">
            <img src="../assets/logo.png" alt="RENTROPY" class="logo-img">
        </a>
        <nav class="nav">
            <a href="index.html" class="nav-link">Home</a>
            <a href="listing.html" class="nav-link">Listings</a>
            <a href="about.html" class="nav-link">About Us</a>
        </nav>
        <div class="header-actions">
            <a href="login.html" class="btn btn-signup">Sign Up</a>
            <a href="login.html" class="btn btn-login">Login</a>
            <a href="chat.html" class="header-icon header-chat" aria-label="Messages" title="Messages"><span class="header-icon-chat" aria-hidden="true">ðŸ’¬</span></a>
            <a href="cart.html" class="header-cart" aria-label="Cart">ðŸ›’</a>
        </div>
    </header>

    <main class="page-main product-page">

        <div class="container">
            
            <nav class="breadcrumb">
                <a href="index.html">Home</a>
                <span aria-hidden="true">/</span>
                <a href="listing.html">Listings</a>
                <span aria-hidden="true">/</span>
                <span> 4-Person Camping Tent </span>
            </nav>

            <div class="product-layout">
                <div class="product-gallery">
                    <div class="product-image-main">
                        <img src="../../assets/camping tent.jpg" alt="4-Person Camping Tent" width="800" height="520">
                    </div>
                    <div class="product-image-thumbs">
                        <button type="button" class="thumb active"><img src="../../assets/camping tent.jpg" alt=""></button>
                        <button type="button" class="thumb"><img src="../../assets/camping tent.jpg" alt=""></button>
                        <button type="button" class="thumb"><img src="../../assets/camping tent.jpg" alt=""></button>
                    </div>
                </div>

                <div class="product-detail">
                    <h1 class="product-title"> 4-Person Camping Tent </h1>
                    <p class="product-category"> Outdoor Gear </p>

                    <div class="product-brand">
                        <div class="product-brand-avatar">G</div>
                        <div>
                            <p class="product-brand-name"> Green Outdoors Co. </p>
                            <a href="#" class="product-brand-link">View brand profile</a>
                        </div>
                    </div>

                    <p class="product-desc"> Spacious 4-person tent, waterproof and easy to set up. Perfect for weekend trips. Well maintained and cleaned after each rental. </p>

                    <div class="product-when-section">
                        <h2 class="product-when-title">When do you need it?</h2>
                        <div class="product-when-fields">
                            <div class="product-when-group">
                                <label class="product-when-label" for="product-start-date">Start date</label>
                                <input type="date" id="product-start-date" class="product-when-input" aria-label="Rental start date">
                            </div>
                            <div class="product-when-group">
                                <label class="product-when-label" for="product-end-date">End date</label>
                                <input type="date" id="product-end-date" class="product-when-input" aria-label="Rental end date">
                            </div>
                        </div>
                    </div>

                    <div class="product-pricing">
                        <h2 class="product-pricing-title">Pricing</h2>
                        <ul class="pricing-table">
                            <li><span>1 day</span><strong>â‚±12</strong></li>
                            <li><span>3 days</span><strong>â‚±32</strong> <small>(â‚±10.67/day)</small></li>
                            <li><span>1 week</span><strong>â‚±70</strong> <small>(â‚±10/day)</small></li>
                            <li><span>2 weeks</span><strong>â‚±120</strong> <small>(â‚±8.57/day)</small></li>
                        </ul>
                    </div>

                    <div class="product-actions">
                        <form action="cart.html" method="get" class="add-to-cart-form">
                            <button type="submit" class="btn btn-primary btn-lg btn-block">Add to cart</button>
                        </form>
                        <a href="#" class="btn btn-signup btn-block" id="product-ask-seller">Inquire</a>
                        <button type="button" class="btn btn-signup btn-block" id="product-save-btn">Save</button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        const items = [
            { id: '1', name: '4-Person Camping Tent', category: 'Outdoor', pricePerDay: 200, image: '../assets/camping tent.jpg', brand: 'Green Outdoors Co.', description: 'Spacious 4-person tent, waterproof and easy to set up. Perfect for weekend trips. Well maintained and cleaned after each rental.' },
            { id: '2', name: 'DSLR Camera Kit', category: 'Electronics', pricePerDay: 1200, image: '../assets/camera.webp', brand: 'Camera Brand', description: 'Professional DSLR camera kit with lenses and accessories.' },
            { id: '3', name: 'Cordless Power Drill', category: 'Tools', pricePerDay: 800, image: '../assets/istockphoto-184639599-612x612.jpg', brand: 'Tool Co.', description: 'Powerful cordless power drill for all your DIY needs.' },
            { id: '4', name: 'Designer Handbag', category: 'Fashion', pricePerDay: 2500, image: '../assets/designer bag.jpg', brand: 'Fashion Brand', description: 'Elegant designer handbag, perfect for any occasion.' },
            { id: '5', name: 'Road Bike', category: 'Outdoor', pricePerDay: 1800, image: '../assets/road bike.jpg', brand: 'Bike Co.', description: 'High-performance road bike for cycling enthusiasts.' },
            { id: '6', name: 'HD Projector', category: 'Electronics', pricePerDay: 1500, image: '../assets/projector.jpg', brand: 'Projector Brand', description: 'High-definition projector for home entertainment.' },
            { id: '7', name: '2-Person Kayak', category: 'Outdoor', pricePerDay: 3500, image: '../assets/kayak.jpg', brand: 'Kayak Co.', description: 'Durable 2-person kayak for water adventures.' },
            { id: '8', name: 'Winter Sleeping Bag', category: 'Outdoor', pricePerDay: 1200, image: '../assets/sleeping bag.webp', brand: 'Outdoor Gear', description: 'Warm winter sleeping bag for cold weather camping.' },
            { id: '9', name: 'Men\'s Wool Blazer', category: 'Fashion', pricePerDay: 2800, image: '../assets/blazer.jpg', brand: 'Fashion Co.', description: 'Stylish men\'s wool blazer for formal occasions.' },
            { id: '10', name: 'Electric Lawn Mower', category: 'Tools', pricePerDay: 800, image: '../assets/lawn mower.jpg', brand: 'Tool Brand', description: 'Efficient electric lawn mower for garden maintenance.' },
            { id: '11', name: 'Camera Gimbal Stabilizer', category: 'Electronics', pricePerDay: 1500, image: '../assets/gimbal.jpg', brand: 'Gimbal Co.', description: 'Professional camera gimbal for smooth video recording.' },
            { id: '12', name: '60L Hiking Backpack', category: 'Outdoor', pricePerDay: 1200, image: '../assets/backpack.jpg', brand: 'Backpack Brand', description: 'Spacious hiking backpack for long treks.' },
            { id: '13', name: 'Evening Gown', category: 'Fashion', pricePerDay: 2800, image: '../assets/evening gown.jpg', brand: 'Fashion Brand', description: 'Elegant evening gown for special events.' },
            { id: '14', name: 'Pressure Washer', category: 'Tools', pricePerDay: 8500, image: '../assets/pressure washer.webp', brand: 'Tool Co.', description: 'High-pressure washer for cleaning tasks.' },
            { id: '15', name: '27" 4K Monitor', category: 'Electronics', pricePerDay: 15000, image: '../assets/monitor.webp', brand: 'Monitor Brand', description: 'Ultra-high-definition 27-inch monitor.' },
            { id: '16', name: 'Portable Camping Stove', category: 'Outdoor', pricePerDay: 1200, image: '../assets/camping stove.jpg', brand: 'Camping Gear', description: 'Compact portable camping stove for outdoor cooking.' },
            { id: '17', name: 'Formal Suit', category: 'Fashion', pricePerDay: 2800, image: '../assets/suit.png', brand: 'Suit Brand', description: 'Classic formal suit for professional settings.' },
            { id: '18', name: 'Circular Saw', category: 'Tools', pricePerDay: 8500, image: '../assets/circular saw.webp', brand: 'Tool Co.', description: 'Powerful circular saw for woodworking.' }
        ];

        function getRentalDaysFromUrl() {
            const params = new URLSearchParams(window.location.search);
            const startVal = params.get('start_date');
            const endVal = params.get('end_date');
            if (!startVal || !endVal) return 1;
            const start = new Date(startVal);
            const end = new Date(endVal);
            if (end < start) return 1;
            const diffTime = end - start;
            return Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1);
        }

        function formatPrice(amount) {
            return 'â‚±' + Number(amount).toLocaleString('en-PH');
        }

        function addToCart(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) return;
            const params = new URLSearchParams(window.location.search);
            const startDate = params.get('start_date') || '';
            const endDate = params.get('end_date') || '';
            const rentalDays = getRentalDaysFromUrl();
            const pricePerDay = item.pricePerDay != null ? item.pricePerDay : parseInt(String(item.price || '0').replace(/[â‚±$,]/g, ''), 10);

            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existing = cart.find(c => c.id === itemId && c.start_date === startDate && c.end_date === endDate);
            if (existing) {
                existing.quantity = (existing.quantity || 1) + 1;
            } else {
                cart.push({
                    ...item,
                    quantity: 1,
                    pricePerDay: pricePerDay,
                    start_date: startDate,
                    end_date: endDate,
                    rental_days: rentalDays
                });
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            window.location.href = 'cart.html';
        }

        function saveForLater() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                alert('Please log in to save items for later.');
                return;
            }
            const item = items.find(i => i.id === itemId);
            if (item) {
                let savedItems = JSON.parse(localStorage.getItem('savedItems')) || [];
                if (savedItems.find(s => s.id === itemId)) {
                    alert('Item already saved!');
                    return;
                }
                savedItems.push(item);
                localStorage.setItem('savedItems', JSON.stringify(savedItems));
                alert('Item saved for later!');
                updateSaveButton(true);
            }
        }

        function unsave() {
            let savedItems = JSON.parse(localStorage.getItem('savedItems')) || [];
            savedItems = savedItems.filter(s => s.id !== itemId);
            localStorage.setItem('savedItems', JSON.stringify(savedItems));
            alert('Item removed from saved!');
            updateSaveButton(false);
        }

        function updateSaveButton(isSaved) {
            const button = document.getElementById('product-save-btn');
            if (!button) return;
            if (isSaved) {
                button.textContent = 'Unsave';
                button.onclick = unsave;
            } else {
                button.textContent = 'Save';
                button.onclick = saveForLater;
            }
        }

        const urlParams = new URLSearchParams(window.location.search);
        const itemId = urlParams.get('id');

        if (itemId) {
            const item = items.find(i => i.id === itemId);
            if (item) {
                // Update title
                document.title = `${item.name} â€“ RENTROPY`;

                // Update breadcrumb
                document.querySelector('.breadcrumb span:last-child').textContent = item.name;

                // Update main image
                const mainImg = document.querySelector('.product-image-main img');
                mainImg.src = item.image;
                mainImg.alt = item.name;

                // Update thumbs
                const thumbs = document.querySelectorAll('.thumb img');
                thumbs.forEach(thumb => thumb.src = item.image);

                // Update product title
                document.querySelector('.product-title').textContent = item.name;

                // Update category
                document.querySelector('.product-category').textContent = item.category;

                // Update brand
                const brandDiv = document.querySelector('.product-brand');
                brandDiv.querySelector('.product-brand-name').textContent = item.brand;

                // Update description
                document.querySelector('.product-desc').textContent = item.description;

                const pricePerDay = item.pricePerDay != null ? item.pricePerDay : parseInt(String(item.price || '0').replace(/[â‚±$,]/g, ''), 10);

                const startInput = document.getElementById('product-start-date');
                const endInput = document.getElementById('product-end-date');
                const params = new URLSearchParams(window.location.search);
                if (startInput) startInput.value = params.get('start_date') || '';
                if (endInput) endInput.value = params.get('end_date') || '';
                const today = new Date().toISOString().slice(0, 10);
                if (startInput) startInput.min = today;
                if (endInput) endInput.min = startInput && startInput.value ? startInput.value : today;

                function getDaysFromInputs() {
                    const s = startInput && startInput.value;
                    const e = endInput && endInput.value;
                    if (!s || !e) return 1;
                    const start = new Date(s);
                    const end = new Date(e);
                    if (end < start) return 1;
                    return Math.max(1, Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1);
                }

                function updatePriceFromDates() {
                    const days = getDaysFromInputs();
                    const total = pricePerDay * days;
                    const priceElement = document.querySelector('.product-pricing');
                    if (!priceElement) return;
                    priceElement.innerHTML = `
                        <h2 class="product-pricing-title">Pricing</h2>
                        <p class="product-price-per-day"><strong>${formatPrice(pricePerDay)}</strong> per day</p>
                        ${days > 1 ? `<p class="product-price-total">Total for ${days} days: <strong>${formatPrice(total)}</strong></p>` : ''}
                    `;
                }

                function syncProductDateConstraints() {
                    if (startInput) startInput.min = today;
                    if (endInput) {
                        endInput.min = startInput && startInput.value ? startInput.value : today;
                        if (endInput.value && startInput && startInput.value && endInput.value < startInput.value)
                            endInput.value = startInput.value;
                    }
                }

                function updateUrlFromDates() {
                    const s = startInput && startInput.value;
                    const e = endInput && endInput.value;
                    const p = new URLSearchParams(window.location.search);
                    if (s) p.set('start_date', s); else p.delete('start_date');
                    if (e) p.set('end_date', e); else p.delete('end_date');
                    const url = p.toString() ? 'product.html?' + p.toString() : 'product.html?' + 'id=' + itemId;
                    window.history.replaceState({}, '', url);
                }

                updatePriceFromDates();

                if (startInput) {
                    startInput.addEventListener('change', function() { syncProductDateConstraints(); updateUrlFromDates(); updatePriceFromDates(); });
                    startInput.addEventListener('input', function() { syncProductDateConstraints(); updateUrlFromDates(); updatePriceFromDates(); });
                }
                if (endInput) {
                    endInput.addEventListener('change', function() { syncProductDateConstraints(); updateUrlFromDates(); updatePriceFromDates(); });
                    endInput.addEventListener('input', function() { syncProductDateConstraints(); updateUrlFromDates(); updatePriceFromDates(); });
                }

                // Add hidden input for id
                const form = document.querySelector('.add-to-cart-form');
                const hiddenId = document.createElement('input');
                hiddenId.type = 'hidden';
                hiddenId.name = 'id';
                hiddenId.value = itemId;
                form.appendChild(hiddenId);

                // Change button to use JavaScript
                const button = form.querySelector('button[type="submit"]');
                button.type = 'button';
                button.onclick = () => addToCart(itemId);

                // Check if item is saved and update button
                const savedItems = JSON.parse(localStorage.getItem('savedItems')) || [];
                updateSaveButton(savedItems.some(s => s.id === itemId));
                const askBtn = document.getElementById('product-ask-seller');
                if (askBtn) askBtn.onclick = function(e) { e.preventDefault(); openProductChat(item); };
            }
        }

        function openProductChat(item) {
            const threadId = 'product_' + item.id;
            const title = 'Inquire: ' + (item.name || 'Product');
            window.location.href = 'chat.html?thread=' + encodeURIComponent(threadId) + '&title=' + encodeURIComponent(title);
        }

        // Check login status and hide/show buttons
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = localStorage.getItem('currentUser');
            const signUpBtn = document.querySelector('.btn-signup');
            const loginBtn = document.querySelector('.btn-login');
            const headerActions = document.querySelector('.header-actions');
            if (currentUser) {
                // User is logged in, hide login and signup buttons, add profile icon
                if (signUpBtn) signUpBtn.style.display = 'none';
                if (loginBtn) loginBtn.style.display = 'none';
                // Add profile icon beside cart
                const cartLink = document.querySelector('.header-cart');
                if (cartLink) {
                    const dashboardLink = document.createElement('a');
                    dashboardLink.href = 'dashboard.html';
                    dashboardLink.className = 'header-icon header-dashboard';
                    dashboardLink.setAttribute('aria-label', 'Dashboard');
                    dashboardLink.setAttribute('title', 'Dashboard');
                    dashboardLink.innerHTML = '<span class="header-icon-dashboard" aria-hidden="true">â–¦</span>';
                    cartLink.insertAdjacentElement('beforebegin', dashboardLink);
                }
            }
        });
    </script>
</body>
</html>
